# Generated by Chef. Local changes will be overwritten.

# TYPE  DATABASE        USER            CIDR-ADDRESS            METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                ident
local   all             all                                     md5
# IPv4 local connections:
host    all             all             127.0.0.1/32            md5
# IPv6 local connections:
host    all             all             ::1/128                 md5

<% unless @slave_members.nil? -%>
# replication
<% @slave_members.each do |member| -%>
host    replication     postgres        <%= member[:ipaddress] %>/32 trust
<% end -%>
<% end -%>

<% unless @mon_members.nil? -%>
# monitoring
<% @mon_members.each do |member| -%>
host    postgres        mon_user  <%= member[:ipaddress] %>/32   md5
<% end -%>
<% end -%>

<% unless @svc_members.nil? -%>
# service boxes
<% @svc_members.each do |member| -%>
host  integration_<%= node.chef_environment %> integration_<%= node.chef_environment %> <%= member[:ipaddress] %>/32        md5
host  plat_<%= node.chef_environment %> plat_<%= node.chef_environment %>  <%= member[:ipaddress] %>/32       md5
<% end -%>
<% end -%>

<% unless @sfi_members.nil? -%>
# salesforce integration
<% @sfi_members.each do |member| -%>
host    plat_<%= node.chef_environment %>     itg_admin     <%= member[:ipaddress] %>/32   md5
<% end -%>
<% end -%>

<% if node['smpostgresql']['server']['enable_sm_lan_access'] -%>
# SecondMarket office access -- for development environments only!
host    integration_<%= node.chef_environment %> integration_<%= node.chef_environment %>  192.168.0.0/16 md5
host    plat_<%= node.chef_environment %> plat_<%= node.chef_environment %> 192.168.0.0/16 md5
host	integration_<%= node.chef_environment %> integration_<%= node.chef_environment %> <%= @sm_gateway %>/32 md5
host    plat_<%= node.chef_environment %> plat_<%= node.chef_environment %> <%= @sm_gateway %>/32 md5
<% end -%>
